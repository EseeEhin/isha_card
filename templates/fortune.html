<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理运势 - 终极版</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .container { max-width: 1200px; }
        .card-header { font-weight: bold; }
    </style>
</head>
<body>
    <div class="container mt-5 mb-5">
        <h1 class="text-center mb-4">管理运势 - 终极模块化版</h1>
        
        <!-- 管理连接词 -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">拼接文本管理</div>
            <div class="card-body">
                <form action="{{ url_for('fortune_web') }}" method="post">
                    <input type="hidden" name="form_type" value="connectors">
                    <div class="mb-3">
                        <label class="form-label">开场白</label>
                        <input type="text" class="form-control" name="intro" value="{{ fortune_data.connectors.intro }}">
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">吉运结尾</label>
                            <input type="text" class="form-control" name="outro_good" value="{{ fortune_data.connectors.outro_good }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">中性结尾</label>
                            <input type="text" class="form-control" name="outro_neutral" value="{{ fortune_data.connectors.outro_neutral }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">厄运结尾</label>
                            <input type="text" class="form-control" name="outro_bad" value="{{ fortune_data.connectors.outro_bad }}">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-info mt-3">保存拼接文本</button>
                </form>
            </div>
        </div>

        <!-- 管理标签池 -->
        {% for pool_name, pool_data in [('good', fortune_data.tag_pools.good), ('neutral', fortune_data.tag_pools.neutral), ('bad', fortune_data.tag_pools.bad)] %}
        <div class="card mb-4">
            <div class="card-header 
                {% if pool_name == 'good' %}bg-success{% elif pool_name == 'neutral' %}bg-secondary{% else %}bg-danger{% endif %} text-white">
                {{ {'good': '吉运', 'neutral': '中性', 'bad': '厄运'}[pool_name] }}标签池管理
            </div>
            <div class="card-body">
                <form action="{{ url_for('fortune_web') }}" method="post">
                    <input type="hidden" name="form_type" value="edit_pool">
                    <input type="hidden" name="pool_name" value="{{ pool_name }}">
                    <table class="table table-sm">
                        <thead><tr><th>标签</th><th>文本片段</th><th>操作</th></tr></thead>
                        <tbody>
                        {% for item in pool_data %}
                            <tr>
                                <td><input type="text" class="form-control form-control-sm" name="tag_{{ item.id }}" value="{{ item.tag }}"></td>
                                <td><input type="text" class="form-control form-control-sm" name="text_{{ item.id }}" value="{{ item.text }}"></td>
                                <td><button type="submit" name="delete_tag" value="{{ item.id }}" class="btn btn-outline-danger btn-sm">删除</button></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <button type="submit" class="btn btn-sm {% if pool_name == 'good' %}btn-success{% elif pool_name == 'neutral' %}btn-secondary{% else %}btn-danger{% endif %}">保存池内变更</button>
                </form>
                <hr>
                <form action="{{ url_for('fortune_web') }}" method="post" class="mt-3">
                    <input type="hidden" name="form_type" value="add_to_pool">
                    <input type="hidden" name="pool_name" value="{{ pool_name }}">
                    <div class="row g-2">
                        <div class="col-auto"><span class="form-text">添加新条目:</span></div>
                        <div class="col"><input type="text" class="form-control form-control-sm" name="new_tag" placeholder="新标签" required></div>
                        <div class="col"><input type="text" class="form-control form-control-sm" name="new_text" placeholder="新文本片段" required></div>
                        <div class="col-auto"><button type="submit" class="btn btn-sm btn-outline-primary">添加</button></div>
                    </div>
                </form>
            </div>
        </div>
        {% endfor %}

        <!-- 管理运势等级 -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">运势等级管理</div>
            <div class="card-body">
                <form action="{{ url_for('fortune_web') }}" method="post">
                    <input type="hidden" name="form_type" value="levels">
                    <table class="table table-sm">
                        <thead><tr><th>ID</th><th>等级名称</th><th>星星数</th><th>星星形状</th><th>图片链接</th></tr></thead>
                        <tbody>
                        {% for level in fortune_data.levels %}
                            <tr>
                                <td>{{ level.id }}</td>
                                <td><input type="text" class="form-control form-control-sm" name="level_name_{{ level.id }}" value="{{ level.level_name }}"></td>
                                <td><input type="number" class="form-control form-control-sm" name="stars_{{ level.id }}" value="{{ level.stars }}" min="1" max="7"></td>
                                <td>
                                    <select class="form-select form-select-sm" name="star_shape_{{ level.id }}">
                                        <option value="star" {% if level.star_shape == 'star' %}selected{% endif %}>星星 ✨</option>
                                        <option value="heart" {% if level.star_shape == 'heart' %}selected{% endif %}>爱心 ❤️</option>
                                        <option value="coin" {% if level.star_shape == 'coin' %}selected{% endif %}>金币 💰</option>
                                        <option value="thorn" {% if level.star_shape == 'thorn' %}selected{% endif %}>荆棘 🥀</option>
                                        <option value="skull" {% if level.star_shape == 'skull' %}selected{% endif %}>骷髅 💀</option>
                                    </select>
                                </td>
                                <td><input type="text" class="form-control form-control-sm" name="image_{{ level.id }}" value="{{ level.image or '' }}" placeholder="输入图片URL"></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <button type="submit" class="btn btn-primary btn-sm">保存等级变更</button>
                </form>
            </div>
        </div>

        <div class="text-center mt-4">
            <a href="/" class="btn btn-secondary">返回主页</a>
        </div>
    </div>
</body>
</html>
